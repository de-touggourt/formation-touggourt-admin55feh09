<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ÙØ¶Ø§Ø¡ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ - ØªÙˆÙ‚Ø±Øª</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
/* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© --- */
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body{
  font-family:'Cairo',sans-serif;
  margin:0;
  background:linear-gradient(135deg,#e3f2fd,#bbdefb);
  text-align:center;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
}

/* ===========================
   1. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
   =========================== */
.news-ticker-container {
    background-color: #0d47a1;
    color: #fff;
    width: 100%;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    z-index: 1000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.typewriter-text {
    font-size: 17px;
    font-weight: 700;
    display: inline-block;
    opacity: 1;
    transition: opacity 1s ease-in-out;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 95%;
}

.typewriter-text.fade-out {
    opacity: 0;
}

/* ===========================
   2. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø´Ø¹Ø§Ø±
   =========================== */
.logo-container {
  position: relative;
  display: inline-block;
  width: 160px;
  height: 160px;
  margin-bottom: 0px; 
  transition: transform 0.3s ease;
}

.logo-container img {
  width: 130px;
  height: 130px;
  border-radius: 50%;
  border: 2px solid #fff;
  object-fit: cover;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff; 
  z-index: 2;
  animation: pulseLogo 2.5s ease-in-out infinite;
}

.logo-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 150px;
  height: 150px;
  border-radius: 50%;
  border: 3px dashed #fff; 
  background: transparent;
  transform: translate(-50%, -50%);
  animation: rotateRing 10s linear infinite;
  z-index: 1;
}

@keyframes rotateRing {
  from { transform: translate(-50%, -50%) rotate(0deg); }
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

@keyframes pulseLogo {
  0%, 100% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.05); }
}

/* ===========================
   ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù‡ÙŠØ¯Ø±
   =========================== */
header{
  background:#1E68E8;
  color:#fff;
  padding:30px 15px;
  border-bottom-left-radius:25px;
  border-bottom-right-radius:25px;
  box-shadow:0 4px 10px rgba(0,0,0,.2);
}

header h1 {
    margin-top: 5px;
    margin-bottom: 10px;
    font-size: 1.8rem;
    padding: 0 10px;
}

/* ===========================
   ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª
   =========================== */
.services{
  display:grid;
  /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ© Ù„ØªØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø¨Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 160 Ø¨ÙƒØ³Ù„ */
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:25px;
  padding:40px 20px;
  max-width:1000px;
  margin:auto;
  flex: 1;
  width: 100%;
}

.service{
  background:#fff;
  border-radius:20px;
  padding:30px 15px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  transition:.4s;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.service:hover{transform:translateY(-8px) scale(1.05);}
.service:active{transform:scale(0.98);}

.service i{
  font-size:55px;
  color:#1E68E8;
  margin-bottom:15px;
}

.service h3{
  color:#0d47a1;
  font-size: 1.1rem;
  margin: 0;
}

/* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */
.icon-container{
  display:flex;
  justify-content:center;
  gap:20px;
  flex-wrap:wrap;
  width: 100%;
}

.icon-btn{
  width:130px;
  height:130px;
  border-radius:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-weight:700;
  border:2px solid #1E68E8;
  background:#f0f7ff;
  cursor:pointer;
  transition:.3s;
  text-align: center;
  padding: 5px;
}

.icon-btn i {
    font-size: 30px;
    margin-bottom: 5px;
}

.icon-btn:hover:not(.closed){
  background:#1E68E8;
  color:#fff;
}

.icon-btn.closed{
  opacity:.5;
  cursor:not-allowed;
}

.badge{
  margin-top:6px;
  padding:4px 10px;
  border-radius:12px;
  font-size:13px;
}
.badge.open{background:#e3f2fd;color:#1565c0;}
.badge.closed{background:#ffebee;color:#c62828;}

footer{
  background:#1E68E8;
  color:#fff;
  padding:16px;
  font-weight:600;
  border-top-left-radius:25px;
  border-top-right-radius:25px;
  margin-top: auto;
  font-size: 0.9rem;
}

/* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª SweetAlert --- */
.swal2-popup { border-radius: 20px !important; padding: 1em !important; }
.swal2-confirm{ background:#939393 !important; color:#333 !important; border-radius:20px !important; padding:10px 30px !important; font-family:'Cairo',sans-serif; font-weight:600; border:none !important; margin: 5px !important; }
.swal2-deny{ 
  background:#1E68E8 !important; 
  color:#fff !important; 
  border-radius:20px !important; 
  padding:10px 30px !important; 
  font-family:'Cairo',sans-serif; 
  font-weight:600; 
  border:none !important; 
  margin: 5px !important; 
}

/* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª --- */
.file-manager-container { text-align: right; direction: rtl; width: 100%; }

.upload-section { 
  background: #f0f7ff; 
  padding: 15px; 
  border-radius: 10px; 
  border: 2px dashed #1E68E8; 
  margin-bottom: 15px; 
  display: flex; 
  gap: 10px; 
  align-items: center; 
  justify-content: center; 
  flex-wrap: wrap; 
}

.file-list { max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; padding: 5px; }

.file-row { 
  background: #fff; 
  border: 1px solid #eee; 
  padding: 10px; 
  border-radius: 8px; 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  transition: 0.2s; 
  box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
}

.file-name-group { display: flex; align-items: center; gap: 10px; font-weight: 600; color: #333; text-decoration: none; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-size: 14px; }
.file-icon { font-size: 20px; width: 25px; text-align: center; }
.fa-file-pdf { color: #d32f2f; } .fa-file-word { color: #1976d2; } .fa-file-image { color: #7b1fa2; }

.delete-btn { 
  background: #ffebee; 
  color: #c62828; 
  border: none; 
  padding: 6px 12px; 
  border-radius: 6px; 
  cursor: pointer; 
  font-size: 12px; 
  font-family: 'Cairo'; 
  transition: 0.3s; 
  display: flex; 
  align-items: center; 
  gap: 5px; 
  flex-shrink: 0;
}

.upload-btn-real { 
  background: #d32f2f; 
  color: white; 
  border: none; 
  padding: 10px 20px; 
  border-radius: 50px; 
  cursor: pointer; 
  font-weight: bold; 
  font-family: 'Cairo'; 
  display: flex; 
  align-items: center; 
  gap: 8px; 
  box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
  font-size: 14px;
}

.spinner { 
  border: 3px solid #f3f3f3; 
  border-top: 3px solid #1E68E8; 
  border-radius: 50%; 
  width: 24px; 
  height: 24px; 
  animation: spin 1s linear infinite; 
  margin: 20px auto; 
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

.info-box{
  max-width: 850px;
  width: 95%;
  margin: 20px auto;
  padding: 20px;
  border: 3px solid rgba(255,255,255,0.8);
  border-radius: 20px;
  background: rgba(255,255,255,0.08);
  color: #ffffff;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

.info-box h1{
  font-size: 24px;
  font-weight: 700;
  margin: 0 0 10px;
}

.info-box hr{
  width: 60%;
  margin: 10px auto;
  border: none;
  height: 2px;
  background: rgba(255,255,255,0.7);
}

.info-box p{
  font-size: 15px;
  font-weight: 700;
  margin: 0;
}

/* ============================================================
   ğŸ“± ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ¬Ø§ÙˆØ¨ (Media Queries) - Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
   ============================================================ */
@media (max-width: 768px) {
    /* 1. ØªØµØºÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø± */
    .logo-container {
        transform: scale(0.9);
        margin-bottom: 0px;
    }

    /* 2. Ø¶Ø¨Ø· Ø§Ù„Ù‡ÙŠØ¯Ø± */
    header h1 {
        font-size: 1.4rem;
        line-height: 1.4;
    }
    
    .info-box h1 { font-size: 1.1rem; }
    .info-box p { font-size: 0.9rem; }

    /* 3. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø¨ÙƒØ© (Grid) Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    .services {
        padding: 20px 15px;
        gap: 15px;
        grid-template-columns: repeat(2, 1fr); /* Ø¹Ù…ÙˆØ¯ÙŠÙ† ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    }
    
    /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¶ÙŠÙ‚Ø© Ø¬Ø¯Ø§Ù‹ØŒ Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ */
    @media (max-width: 380px) {
        .services { grid-template-columns: 1fr; }
    }

    .service {
        padding: 20px 10px;
        min-height: 140px;
    }

    .service i {
        font-size: 40px;
        margin-bottom: 10px;
    }

    .service h3 {
        font-size: 0.95rem;
    }

    /* 4. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©) */
    .icon-btn {
        width: 46%; /* Ø²Ø±ÙŠÙ† Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶ */
        height: 110px;
        font-size: 0.85rem;
    }
    
    .icon-container { gap: 10px; }

    /* 5. ØªØ­Ø³ÙŠÙ† Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙØ¹ */
    .upload-section {
        flex-direction: column; /* ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ */
        padding: 10px;
    }
    
    .upload-btn-real {
        width: 100%; /* Ø§Ù„Ø²Ø± ÙŠØ£Ø®Ø° ÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø±Ø¶ */
        justify-content: center;
    }
    
    #fileNameDisplay {
        width: 100%;
        text-align: center;
        margin: 5px 0;
    }

    /* 6. ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© */
    footer { font-size: 0.75rem; padding: 12px; }
    .typewriter-text { font-size: 13px; }
}
</style>
</head>

<body>

<div class="news-ticker-container">
    <span id="typewriter-text" class="typewriter-text"></span>
</div>

<header>
  <div class="logo-container">
    <div class="logo-ring"></div>
    <img 
      src="https://drive.google.com/thumbnail?id=1BqWoqh1T1lArUcwAGNF7cGnnN83niKVl&sz=w400" 
      onerror="this.src='https://cdn-icons-png.flaticon.com/512/3413/3413535.png'"
      alt="Ø´Ø¹Ø§Ø±"
    >
  </div>

  <h1>ÙØ¶Ø§Ø¡ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ - ØªÙˆÙ‚Ø±Øª</h1>

<div class="info-box">
  <h1>Ù…Ø±ÙƒØ² Ø§Ù„ØªÙƒÙˆÙŠÙ† Ù…ØªÙˆØ³Ø·Ø© Ø¯Ù‚Ø¹Ø© Ø§Ù„Ø·Ø§Ù‡Ø± Ø¨Ù† Ø§Ù„Ø²Ø§ÙˆÙŠ</h1>
  <hr>
  <p>Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ Ù„Ø£Ø³Ø§ØªØ°Ø© Ø§Ù„Ø·ÙˆØ± Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ - ØªØ®ØµØµ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</p>
</div>
  
</header>

<section class="services">
<div class="service" onclick="openCourses('didactique')"><i class="fa-solid fa-chalkboard"></i><h3>ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…Ø§Ø¯Ø© Ø§Ù„ØªØ®ØµØµ</h3></div>
<div class="service" onclick="openCourses('tasyire')"><i class="fa-solid fa-users-gear"></i><h3>ØªÙ‚Ù†ÙŠØ§Øª ØªØ³ÙŠÙŠØ± Ø§Ù„Ù‚Ø³Ù…</h3></div>
<div class="service" onclick="openCourses('takwime')"><i class="fa-solid fa-clipboard-check"></i><h3>Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ùˆ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠØ©</h3></div>
<div class="service" onclick="openCourses('informatique')"><i class="fa-solid fa-computer"></i><h3>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¢Ù„ÙŠ</h3></div>
<div class="service" onclick="openCourses('nidame')"><i class="fa-solid fa-school"></i><h3>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¨ÙˆÙŠ Ùˆ Ø§Ù„Ù…Ù†Ø§Ù‡Ø¬</h3></div>
<div class="service" onclick="openCourses('akhlakiyate')"><i class="fa-solid fa-scale-balanced"></i><h3>Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ø©</h3></div>
<div class="service" onclick="openCourses('handasa')"><i class="fa-solid fa-network-wired"></i><h3>Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ØªÙƒÙˆÙŠÙ†</h3></div>
<div class="service" onclick="openCourses('wasata')"><i class="fa-solid fa-handshake"></i><h3>Ø§Ù„ÙˆØ³Ø§Ø·Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</h3></div>
<div class="service" onclick="openCourses('tachri')"><i class="fa-solid fa-gavel"></i><h3>Ø§Ù„ØªØ´Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ</h3></div>
<div class="service" onclick="openCourses('psycho')"><i class="fa-solid fa-brain"></i><h3>Ø¹Ù„ÙˆÙ… Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ¹Ù„Ù… Ø§Ù„Ù†ÙØ³</h3></div>
</section>

<footer>Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ù„ÙˆÙ„Ø§ÙŠØ© ØªÙˆÙ‚Ø±Øª | ÙØ¶Ø§Ø¡ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠ | Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©  Â© 2025</footer>

<script>
/* ==========================================
   ğŸ”¡ ÙƒÙˆØ¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ù„Ø³Ø©
   ========================================== */
const textToType = "Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ© | ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© | Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ù„ÙˆÙ„Ø§ÙŠØ© ØªÙˆÙ‚Ø±Øª | Ù…ØµÙ„Ø­Ø© Ø§Ù„ØªÙØªÙŠØ´ ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ†";
const typeWriterElement = document.getElementById('typewriter-text');
let charIndex = 0;

function typeWriter() {
    if (charIndex < textToType.length) {
        typeWriterElement.innerHTML += textToType.charAt(charIndex);
        charIndex++;
        setTimeout(typeWriter, 45); 
    } else {
        setTimeout(startFadeOut, 3000); 
    }
}

function startFadeOut() {
    typeWriterElement.classList.add('fade-out');
    setTimeout(() => {
        typeWriterElement.innerHTML = "";
        charIndex = 0;
        typeWriterElement.classList.remove('fade-out'); 
        setTimeout(typeWriter, 500); 
    }, 1000);
}

window.onload = function() { typeWriter(); };

/* =========================================
   âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
   ========================================= */
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_eNgM1R-fILJq00iye9-3eeFCFjKBkMcej4VOq53gG5gshOsulAH7b-X0_JkHHrkyJw/exec"; 

const driveLinks = {
  didactique:{1:"https://drive.google.com/drive/folders/130Fogml3fCsFkUdpNIoaFXvAWfypD5v0?usp=drive_link",2:"",3:""},
  tasyire:{1:"https://drive.google.com/drive/folders/1vtK5JBS7vmskAU14Ph7-oWBG13o6IAB_?usp=drive_link",2:"",3:""},
  takwime:{1:"https://drive.google.com/drive/folders/1AqQTkajWK1xePfqGEE9wOtkQsQHHibFj?usp=drive_link",2:"",3:""},
  nidame:{1:"https://drive.google.com/drive/folders/16JwrdI4ziALQJ173zbhehNxkjczBPxEu?usp=drive_link",2:"",3:""},
  akhlakiyate:{1:"https://drive.google.com/drive/folders/18KVnZ022tFOoqfTJXGrWtnRHrzMpOKZM?usp=drive_link",2:"",3:""},
  handasa:{1:"https://drive.google.com/drive/folders/1tkikbCZ-fYmMroJ5yGZ3FxdHPEvq1wY4?usp=drive_link",2:"",3:""},
  wasata:{1:"https://drive.google.com/drive/folders/1OqdCf5cHxJUIX1YIlZ1ZefxmEOzIkG_q?usp=drive_link",2:"",3:""},
  tachri:{1:"https://drive.google.com/drive/folders/1M2DQRT3gaaoq3VL1NxKgCVxsx6i0Ll9u?usp=drive_link",2:"",3:""},
  psycho:{1:"https://drive.google.com/drive/folders/1ZExuodHzj5LkWCkgajk67sS4S0IZdOjF?usp=drive_link",2:"",3:""},
  informatique:{1:"https://drive.google.com/drive/folders/1MIBO4TNu1bJhaZ2S2lHtD5WYPESsge5u?usp=drive_link",2:"HHHH",3:"IIII"}
};

const globalCycleStatus = {1:true, 2:false, 3:false};
const moduleCycleStatus = {
  didactique:{1:true,2:true,3:true}, tasyire:{1:true,2:true,3:true}, takwime:{1:true,2:true,3:true},
  nidame:{1:true,2:true,3:true}, akhlakiyate:{1:true,2:true,3:true}, handasa:{1:true,2:true,3:true},
  wasata:{1:true,2:true,3:true}, tachri:{1:true,2:true,3:true}, psycho:{1:true,2:true,3:true},
  informatique:{1:true,2:true,3:true}
};

function isCycleOpen(module,cycle){
  if(!globalCycleStatus[cycle]) return false;
  return moduleCycleStatus[module][cycle];
}

function getFolderId(url) {
    if (!url) return null;
    const match = url.match(/folders\/([a-zA-Z0-9-_]+)/);
    return match ? match[1] : null;
}

// ğŸ“± Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø§Ø²
function getSwalWidth(desktopSize) {
    return window.innerWidth < 768 ? '95%' : desktopSize;
}

// ğŸ”¹ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ±Ø©
function openCourses(module){
  let html='<div class="icon-container">';
  for(let i=1;i<=3;i++){
    const open=isCycleOpen(module,i);
    html+=`
      <div class="icon-btn ${open?'':'closed'}"
        onclick="${open?`openFileManager('${module}',${i})`:''}">
        Ø§Ù„Ø¯ÙˆØ±Ø© ${i===1?'Ø§Ù„Ø£ÙˆÙ„Ù‰':i===2?'Ø§Ù„Ø«Ø§Ù†ÙŠØ©':'Ø§Ù„Ø«Ø§Ù„Ø«Ø©'}
        <span class="badge ${open?'open':'closed'}">
          ${open?'Ù…ÙØªÙˆØ­Ø©':'Ù…ØºÙ„Ù‚Ø©'}
        </span>
      </div>`;
  }
  html+='</div>';

  Swal.fire({
    title: 'Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±Ø©',
    html: html,
    showConfirmButton: true,
    confirmButtonText: 'Ø¥ØºÙ„Ø§Ù‚',
    width: getSwalWidth('600px') // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨
  });
}

// ğŸ”¹ ÙØªØ­ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ù„ÙØ§Øª
function openFileManager(module, cycle) {
  const url = driveLinks[module][cycle];
  const folderId = getFolderId(url);

  if (!url || !folderId) {
    Swal.fire('Ø®Ø·Ø£', 'Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¬Ù„Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
    return;
  }

  Swal.fire({
    title: 'Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª...',
    html: '<div class="spinner"></div>',
    showConfirmButton: false,
    width: getSwalWidth('700px'),
    allowOutsideClick: false
  });

  fetch(`${APPS_SCRIPT_URL}?action=list&folderId=${folderId}`)
  .then(res => res.json())
  .then(data => {
    if(data.error) {
        Swal.fire('Ø®Ø·Ø£', 'ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙˆØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯', 'error');
    } else {
        renderFileManager(folderId, data.files, module, cycle);
    }
  })
  .catch(err => Swal.fire('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø±Ø§Ø¨Ø· Apps Script Ø§Ù„ØµØ­ÙŠØ­', 'error'));
}

function renderFileManager(folderId, files, module, cycle) {
    let filesHtml = '';
    
    if(!files || files.length === 0) {
        filesHtml = '<div style="text-align:center; padding:20px; color:#777;">Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙØ§Ø±Øº</div>';
    } else {
        files.forEach(file => {
            let iconClass = 'fa-file'; 
            if(file.type.includes('pdf')) iconClass = 'fa-file-pdf';
            else if(file.type.includes('image')) iconClass = 'fa-file-image';
            else if(file.type.includes('word') || file.type.includes('doc')) iconClass = 'fa-file-word';

            filesHtml += `
            <div class="file-row">
                <a href="${file.url}" target="_blank" class="file-name-group">
                    <i class="fa-solid ${iconClass} file-icon"></i> ${file.name}
                </a>
                <button class="delete-btn" onclick="deleteFile('${file.id}', '${folderId}', '${module}', ${cycle})">
                    <i class="fa-solid fa-trash"></i> Ø­Ø°Ù
                </button>
            </div>
            `;
        });
    }

    const htmlContent = `
    <div class="file-manager-container">
        <div class="upload-section">
            <input type="file" id="fileInput" style="display:none" onchange="document.getElementById('fileNameDisplay').innerText = this.files[0].name">
            <button class="upload-btn-real" onclick="document.getElementById('fileInput').click()">
                <i class="fa-solid fa-folder-open"></i> Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹
            </button>
            <span id="fileNameDisplay" style="font-size:12px; color:#666; margin:0 10px; display:block; width:100%;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</span>
            <button class="upload-btn-real" style="background:#1E68E8" onclick="uploadFile('${folderId}', '${module}', ${cycle})">
                <i class="fa-solid fa-cloud-arrow-up"></i> Ø±ÙØ¹ Ø§Ù„Ø¢Ù†
            </button>
        </div>

        <div class="file-list">
            ${filesHtml}
        </div>
    </div>
    `;

    Swal.fire({
        title: `Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯ÙˆØ±Ø© ${cycle}`,
        html: htmlContent,
        width: getSwalWidth('700px'), // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨
        showConfirmButton: true,
        confirmButtonText: 'Ø¥ØºÙ„Ø§Ù‚',
        showDenyButton: true,
        denyButtonText: 'Ø¹ÙˆØ¯Ø©',
        scrollbarPadding: false
    }).then((res) => {
        if(res.isDenied) openCourses(module);
    });
}

function deleteFile(fileId, folderId, module, cycle) {
    Swal.fire({
        title: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ',
        text: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°ÙÙ‡!',
        cancelButtonText: 'Ø¥Ù„ØºØ§Ø¡',
        width: getSwalWidth('500px')
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...', showConfirmButton: false});
            
            fetch(`${APPS_SCRIPT_URL}?action=delete&fileId=${fileId}&folderId=${folderId}`, {method: 'POST'})
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success') {
                    Swal.fire('ØªÙ…!', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù.', 'success')
                    .then(() => openFileManager(module, cycle)); 
                } else {
                    Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'error');
                }
            });
        }
    });
}

function uploadFile(folderId, module, cycle) {
    const fileInput = document.getElementById('fileInput');
    if(fileInput.files.length === 0) {
        Swal.showValidationMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
        const rawData = e.target.result.split(',')[1];
        
        Swal.fire({
            title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...',
            html: 'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± <div class="spinner"></div>',
            showConfirmButton: false,
            allowOutsideClick: false,
            width: getSwalWidth('500px')
        });

        const formData = new FormData();
        formData.append('action', 'upload');
        formData.append('folderId', folderId);
        formData.append('data', rawData);
        formData.append('name', file.name);
        formData.append('mime', file.type);

        fetch(APPS_SCRIPT_URL, {method: 'POST', body: formData})
        .then(res => res.json())
        .then(data => {
            if(data.status === 'success') {
                Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success')
                .then(() => openFileManager(module, cycle));
            } else {
                Swal.fire('Ø®Ø·Ø£', 'ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹', 'error');
            }
        })
        .catch(err => Swal.fire('Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹', 'error'));
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
